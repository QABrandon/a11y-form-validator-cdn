(function(){'use strict';console.log('üîß A11y Form Validator ‚Äì CDN v1.0.30');var HAS_VALID_LICENSE=false;var STYLES_INJECTED=false;var BASE_ALLOWED_DOMAINS=[ 'webflow.io','webflow.com','netlify.app','vercel.app','github.io','localhost','127.0.0.1' ];var dynamicAllowedDomains=[];var domainsLoaded=false;function hostMatchesAllowed(hostname,domain){if(domain==='localhost' || domain==='127.0.0.1')return hostname===domain;if(hostname===domain)return true;return hostname.endsWith('.' + domain);}async function fetchCustomDomains(){try{var siteId=window.WEBFLOW_SITE_ID || document.querySelector('meta[name="webflow-site-id"]')?.content || extractSiteIdFromUrl();if(!siteId)return [];var resp=await fetch('https:if(!resp.ok)return [];var data=await resp.json();var names=[];(data.custom_domains || []).forEach(function(d){if(typeof d==='string')names.push(d);else if(d && d.name)names.push(d.name);});(data.domains || []).forEach(function(d){if(typeof d==='string' && names.indexOf(d)===-1)names.push(d);});return names;}catch(e){return [];}}function extractSiteIdFromUrl(){var h=window.location.hostname;return h.endsWith('.webflow.io')? h.replace('.webflow.io',''):null;}async function validateDomain(){if(!domainsLoaded){dynamicAllowedDomains=await fetchCustomDomains();domainsLoaded=true;}var hostname=window.location.hostname;var allowed=BASE_ALLOWED_DOMAINS.concat(dynamicAllowedDomains);var ok=allowed.some(function(d){return hostMatchesAllowed(hostname,d);});if(!ok){console.error('üö´ Unauthorized domain:',hostname,'Allowed:',allowed);return false;}return true;}function validateLicense(){var k=window.A11Y_LICENSE_KEY || document.querySelector('meta[name="a11y-license"]')?.content || document.querySelector('meta[name="a11y-form-validator-license"]')?.content;if(!k || k.length < 10)return false;return true;}async function initializeSecurity(){var domainValid=await validateDomain();if(!domainValid)return false;HAS_VALID_LICENSE=validateLicense();return true;}function getFieldLabel(field){var id=field.getAttribute('id');if(id){var lbl=document.querySelector('label[for="' + id + '"]');if(lbl && lbl.textContent.trim())return lbl.textContent.trim();}var by=field.getAttribute('aria-labelledby');if(by){var el=document.getElementById(by);if(el && el.textContent.trim())return el.textContent.trim();}var a=field.getAttribute('aria-label');if(a)return a;var d=field.getAttribute('data-field-label');if(d)return d;var n=field.getAttribute('name');if(n)return n.replace(/[-_]/g,' ').replace(/\b\w/g,function(m){return m.toUpperCase();});return 'This field';}function fieldMessage(type,fieldLabel,ctx){ctx=ctx ||{};var map={required:'{f}is required',email:'{f}must be a valid email address',phone:'{f}must be a valid phone number',url:'{f}must be a valid URL',minlength:'{f}must be at least{min}characters long',maxlength:'{f}must be no more than{max}characters long',pattern:'{f}format is invalid'};var msg=map[type] || 'Please check{f}';return msg.replace('{f}',fieldLabel).replace('{min}',ctx.min || '').replace('{max}',ctx.max || '');}function ensureSlot(field){var errorId=field.getAttribute('data-error-id');var slot=errorId ? document.getElementById(errorId):null;console.log('üîß ensureSlot for field:',field.name || field.id,{hasErrorId:!!errorId,errorId:errorId,hasNeedsErrorContainer:field.hasAttribute('data-needs-error-container'),existingSlot:!!slot});if(!slot && field.hasAttribute('data-needs-error-container')){if(!errorId){errorId='a11y-error-' +(field.name || field.id || 'field')+ '-' + Date.now();field.setAttribute('data-error-id',errorId);console.log(' Created new error ID:',errorId);}slot=document.createElement('div');slot.id=errorId;slot.className='a11y-error-message';slot.setAttribute('aria-live','polite');field.insertAdjacentElement('afterend',slot);console.log(' Created error container element:',slot);}return slot || null;}function showError(field,message){console.log('üö® showError called for field:',field.name || field.id,'message:',message);var slot=ensureSlot(field);if(slot){slot.textContent=message;slot.style.display='';console.log(' Error message displayed in slot:',slot.id);}else{console.log(' No error slot available for field');}field.setAttribute('aria-invalid','true');if(slot && slot.id){var ids=(field.getAttribute('aria-describedby')|| '').split(/\s+/).filter(Boolean);if(ids.indexOf(slot.id)===-1)ids.push(slot.id);field.setAttribute('aria-describedby',ids.join(' '));console.log(' Set aria-describedby to:',field.getAttribute('aria-describedby'));}}function hideError(field){var id=field.getAttribute('data-error-id');if(id){var slot=document.getElementById(id);if(slot)slot.textContent='';}field.removeAttribute('aria-invalid');field.removeAttribute('aria-describedby');}function isValidEmail(v){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);}function isValidPhone(v){return /^[0-9\s\-\(\)\+]{10,}$/.test(v);}function isValidUrl(u){try{new URL(u);return true;}catch(e){return false;}}function validateFieldVanilla(field){console.log('üîç validateFieldVanilla called for:',field.name || field.id,'value:',field.value);hideError(field);var label=getFieldLabel(field);var tag=field.tagName.toLowerCase();var type=(field.type || '').toLowerCase();console.log(' Field details:',{label,tag,type,required:field.hasAttribute('required')});if((type==='radio' || type==='checkbox')&& field.hasAttribute('required')){var group=field.form && field.name ? field.form.querySelectorAll('[name="'+field.name+'"]'):null;if(group && !Array.prototype.some.call(group,function(g){return g.checked;})){showError(field,fieldMessage('required',label));return false;}return true;}var val=(field.value || '').trim();if(field.hasAttribute('required')&& !val){showError(field,fieldMessage('required',label));return false;}if(type==='email' && val && !isValidEmail(val)){showError(field,fieldMessage('email',label));return false;}if(type==='tel' && val && !isValidPhone(val)){showError(field,fieldMessage('phone',label));return false;}if(type==='url' && val && !isValidUrl(val)){showError(field,fieldMessage('url',label));return false;}var min=field.getAttribute('minlength');if(min && val && val.length < +min){showError(field,fieldMessage('minlength',label,{min:min}));return false;}var max=field.getAttribute('maxlength');if(max && val && val.length > +max){showError(field,fieldMessage('maxlength',label,{max:max}));return false;}var pat=field.getAttribute('pattern');if(pat && val && !(new RegExp(pat).test(val))){showError(field,fieldMessage('pattern',label));return false;}return true;}function bindWithJQuery($form){$form.attr('novalidate','');$form.on('invalid',function(e){e.preventDefault();},true);var a11yFields=$form.find(':input[name]').filter(function(){return this.hasAttribute('required')|| this.hasAttribute('data-field-label')|| this.hasAttribute('data-a11y-validator')|| this.hasAttribute('data-needs-error-container');});console.log('üîç jQuery mode - Found',a11yFields.length,'fields with A11y validator attributes');a11yFields.each(function(i,f){console.log(' Field',i + 1,':',f.name || f.id || 'unnamed',{type:f.type,hasRequired:f.hasAttribute('required'),hasDataFieldLabel:f.hasAttribute('data-field-label'),hasDataA11yValidator:f.hasAttribute('data-a11y-validator'),hasDataNeedsErrorContainer:f.hasAttribute('data-needs-error-container'),hasDataErrorId:f.hasAttribute('data-error-id')});});a11yFields.each(function(){var $el=$(this);var r={},m={};if(this.hasAttribute('required')){r.required=true;m.required=fieldMessage('required',getFieldLabel(this));}var t=(this.type || '').toLowerCase();if(t==='email')r.email=true;if(t==='url')r.url=true;var min=this.getAttribute('minlength');if(min)r.minlength=+min;var max=this.getAttribute('maxlength');if(max)r.maxlength=+max;var pat=this.getAttribute('pattern');if(pat)r.pattern=pat;if(!$.isEmptyObject(r)){$el.rules('add',r);if(!$.isEmptyObject(m))$el.rules('add',{messages:m});}});$form.validate({ignore:[],focusInvalid:true,errorElement:'div',errorClass:'a11y-error-message',errorPlacement:function(error,element){var $el=$(element);var id=$el.attr('data-error-id');var $slot=id ? $('#' + id):$();if(!$slot.length && $el.is('[data-needs-error-container]')){if(!id){id='a11y-error-' +($el.attr('name')|| $el.attr('id')|| 'field')+ '-' + Date.now();$el.attr('data-error-id',id);}$slot=$('<div>',{id:id,'aria-live':'polite','class':'a11y-error-message'}).insertAfter($el);}if($el.is(':radio,:checkbox')){var group=$form.find(':input[name="'+$el.attr('name')+'"]');var $first=$(group.get(0));if(!$slot.length){var fid=$first.attr('data-error-id');$slot=fid ? $('#'+fid):$();if(!$slot.length && $first.is('[data-needs-error-container]')){fid='a11y-error-' +($first.attr('name')|| $first.attr('id')|| 'field')+ '-' + Date.now();$first.attr('data-error-id',fid);$slot=$('<div>',{id:fid,'aria-live':'polite','class':'a11y-error-message'}).insertAfter($first);}}if($slot.length)$slot.empty().append(error);else error.insertAfter($first);setAria($first,$slot,true);}else{if($slot.length)$slot.empty().append(error);else error.insertAfter($el);setAria($el,$slot,true);}},highlight:function(el){var $el=$(el);var $slot=$el.attr('data-error-id')? $('#'+$el.attr('data-error-id')):$();setAria($el,$slot,true);},unhighlight:function(el){var $el=$(el);var id=$el.attr('data-error-id');if(id){var $slot=$('#'+id);if($slot.length)$slot.empty();}setAria($el,null,false);},invalidHandler:function(e,v){if(v.errorList && v.errorList.length){v.errorList[0].element.focus();}var $status=$form.find('[role="status"],[aria-live]').first();if($status.length)$status.text('Please fix the highlighted errors.');}});function setAria($el,$slot,hasError){if(!hasError){$el.removeAttr('aria-invalid aria-describedby');return;}$el.attr('aria-invalid','true');if($slot && $slot.length){var id=$slot.attr('id');var d=($el.attr('aria-describedby')|| '').split(/\s+/).filter(Boolean);if(d.indexOf(id)===-1)d.push(id);$el.attr('aria-describedby',d.join(' '));}}}function bindVanilla(form){form.setAttribute('novalidate','novalidate');form.addEventListener('invalid',function(e){e.preventDefault();e.stopPropagation();},true);var fields=Array.prototype.filter.call(form.querySelectorAll('input,textarea,select'),function(f){var t=(f.type || '').toLowerCase();var allowed=(t==='email' || t==='tel' || t==='url' || t==='text')|| f.tagName.toLowerCase()==='textarea' || t==='radio' || t==='checkbox';var hasAny=f.hasAttribute('required')|| f.hasAttribute('data-field-label')|| f.hasAttribute('data-a11y-validator')|| f.hasAttribute('data-needs-error-container');return allowed && hasAny;});console.log('üîç Vanilla mode - Found',fields.length,'fields with A11y validator attributes');fields.forEach(function(f,i){console.log(' Field',i + 1,':',f.name || f.id || 'unnamed',{type:f.type,hasRequired:f.hasAttribute('required'),hasDataFieldLabel:f.hasAttribute('data-field-label'),hasDataA11yValidator:f.hasAttribute('data-a11y-validator'),hasDataNeedsErrorContainer:f.hasAttribute('data-needs-error-container'),hasDataErrorId:f.hasAttribute('data-error-id')});});fields.forEach(function(f){if(!f.getAttribute('data-error-id')&& f.hasAttribute('data-needs-error-container')){f.setAttribute('data-error-id','a11y-error-' +(f.name || f.id || 'field')+ '-' + Date.now());}f.addEventListener('blur',function(){validateFieldVanilla(f);});f.addEventListener('input',function(){hideError(f);});f.addEventListener('focus',function(){hideError(f);});});function onSubmit(e){console.log('üìù Form submit event triggered');var ok=true,firstErr=null;fields.forEach(function(f){var valid=validateFieldVanilla(f);if(!valid && !firstErr)firstErr=f;ok=ok && valid;});console.log(' Form validation result:',{valid:ok,firstError:firstErr ?(firstErr.name || firstErr.id):null});if(!ok){e.preventDefault();e.stopPropagation();console.log(' Form submission prevented,focusing first error field');firstErr && firstErr.focus();}else{console.log(' Form validation passed,allowing submission');}}form.addEventListener('submit',onSubmit);}function injectStyles(){if(STYLES_INJECTED)return;var style=document.createElement('style');style.id='a11y-form-validator-styles';style.textContent='\ \ .a11y-error-message{\ display:block;\ margin-top:8px;\ font-size:14px;\ line-height:1.4;\ color:#721c24;\ background-color:#f8d7da;\ border:1px solid #f5c6cb;\ padding:8px 12px;\ border-radius:4px;\ font-weight:600;\ font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;\}\ \ \ [aria-invalid="true"]{\ outline:2px solid #b00020;\ outline-offset:2px;\}\ \ \ .sr-only{\ position:absolute!important;\ width:1px;height:1px;\ padding:0;margin:-1px;overflow:hidden;\ clip:rect(0,0,0,0);white-space:nowrap;border:0;\}';document.head.appendChild(style);STYLES_INJECTED=true;console.log('‚úÖ A11y Form Validator styles injected');}async function initializeValidation(){var allowed=await initializeSecurity();if(!allowed)return;injectStyles();var forms=document.querySelectorAll('form');if(!forms.length)return;var hasJQ=!!(window.jQuery && window.jQuery.validator);if(hasJQ){window.jQuery(function(){forms.forEach(function(f){bindWithJQuery(window.jQuery(f));});});}else{forms.forEach(bindVanilla);}console.log('‚úÖ A11y Form Validator initialized for',forms.length,'form(s). Mode:',hasJQ ? 'jQuery':'Vanilla');}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initializeValidation);}else{initializeValidation();}})();